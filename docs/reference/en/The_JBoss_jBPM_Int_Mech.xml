<?xml version="1.0" encoding="UTF-8"?>
<chapter id="The_JBoss_jBPM_Int_Mech" xreflabel="The_JBoss_jBPM_Int_Mech">
    <?dbhtml filename="The_JBoss_jBPM_Int_Mech.html"?>
    <chapterinfo>
        <keywordset>
            <keyword>jBPM</keyword>
            <keyword/>
            <keyword/>
            <keyword/>
            <keyword/>
        </keywordset>
    </chapterinfo>
    <title>Actions : The JBoss jBPM Integration Mechanism</title>

    <para> In this chapter we will show how to do software integration with <property>JBoss
        jBPM</property>. The standard mechanism to implement this is to wrap the functionality you
        want to integrate in a class that implements the <emphasis>
            <property>ActionHandler</property>
        </emphasis> interface. In order to demonstrate it let's specify Hello World action for our
        process.</para>

    <section>
        <title>Creating a Hello World Action</title>

        <para>Each Hello World process should integrate one or more Hello World actions, so this is
            what we will be doing. We can integrate custom code at different points in the process
            definition. To do this we have to specify an action handler, represented by an
            implementation of the <emphasis>
                <property>ActionHandler</property>
            </emphasis> interface, and attach this piece of code to a particular event. These events
            are amongst others, going over a transition, leaving or entering nodes, after and before
            signalling. </para>

        <para> To make things a little bit more concrete, let&apos;s create a new class called <emphasis>
                <property>HelloActionHandler</property>.
            </emphasis> For that firstly we&apos;ll create a new package <emphasis>
                <property>com.jbay.action</property>
            </emphasis> in the <emphasis>
                <property>src/java/main</property>
            </emphasis> folder of our project. Then, we should call New Class Creation wizard as
            usual by right-clicking and navigating <emphasis>
                <property>New > Class</property>.
            </emphasis> </para>

        <figure>
            <title>Creating HelloActionHendler Class</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_1.png"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>Notice that two first gaps have been filled automatically. Here, instead of <emphasis>
                <property>Package</property>
            </emphasis> option <emphasis>
                <property>Enclose type</property>
            </emphasis> option can be selected where a type in which to enclose a new class should
            be specified.</para>

        <para>In our case, we leave everything as it is, just type <emphasis>
                <property>HelloActionHandler</property>
            </emphasis> as a name of new class and add <emphasis>
                <property>org.jbpm.graph.ActionHendler</property>
            </emphasis> interface as it&apos;s shown in the picture above.</para>

        <para>Thus, our <emphasis>
                <property>HelloActionHandler</property>
            </emphasis> implements the <emphasis>
                <property>ActionHandler</property>
            </emphasis> interface including the <emphasis>
                <property>execute</property>
            </emphasis> method as shown in the next figure. Here, we add a variable named <emphasis>
                <property>greeting</property>
            </emphasis> to the collection of process variables and put     a message in it :
                <emphasis>&quot;Hello from ActionHandler&quot;</emphasis>. </para>

        <figure>
            <title>A Simple Hello Action</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_2.png" scale="75"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>Now, as we have <emphasis>
                <property>HelloActionHandler</property>
            </emphasis> class defined, let&apos;s explore how we can handle it.</para>
    </section>

    <section>
        <title>Integrating the Hello World Action</title>

        <para>The main purpose of this chapter is to provide you with the steps associating our
            Hello World action with a particular event and test the correctness of our actions as
            well.</para>

        <para> As good Testcity citizens we will first create a Unit Test that proves the behaviour
            we want to achieve by adding the <emphasis>
                <property>ActionHandler</property>
            </emphasis> to the process. So we implement another test.</para>
            
           <para>At first, let&apos;s return to the
               code we already saw <link linkend="hello_test">in the previous chapter</link> and add new test method <emphasis>
                   <property>testActionHendler</property></emphasis> to it. </para>
               
           <figure>
                   <title>Create the Hello Action Test</title>
                   
                   <mediaobject>
                       <imageobject>
                           <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_3.png"
                               scale="75"/>
                       </imageobject>
                   </mediaobject>
            </figure>
               
           <para>We assert
            that no variable called <emphasis>
                <property>greeting</property>
            </emphasis> exist. Then we give the process a signal to move it to the auction state. We
            want to associate the execution of the action with the event of going over the
            transition from the start state to the auction state. So after the signal, the process
            should be in the auction state as in the previous scenario. But moreover, the <emphasis>
                <property>greeting</property>
            </emphasis> variable should exist and contain the string <emphasis>&quot;Hello from
            ActionHandler&quot;</emphasis>. That&apos;s what we assert in the last lines of the test
            method.</para>

        

        <para> Running the tests now results in a failure. The point is that we did not associate
            the action with any particular event in the process definition, so the process variable
            did not get set. </para>

        <figure>
            <title>Test Results Before Integration</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_4.png"
                        scale="75"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para> Let&apos;s do something about it and add an action to the first transition of our
            sample process. To do this you can use the Actions tab in the Properties Editor that is
            under the graphical canvas. Bring up the popup menu of the action element container and
            chose New Action as it's shown on the figure below. The other way to add an action
            to the transition is simply to use the dropdown menu that is available under the action
            icon in the right upper corner of the Properties View.</para>

        <figure>
            <title>Adding an Action to a Transition</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_5.png" scale="80"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>After adding the action a tabbed view with three pages will appear.</para>

        <figure>
            <title>Configuration Dialog for an Action</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_6.png" scale="80"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>The first of these three pages allows you to give the Action a name. The last page
            contains some advanced attributes such as whether the Action is asynchronous. The
            Details page is the most important. It allows to choose and configure the actual action
            handler implementation. </para>

        <figure>
            <title>The Details page of an Action Configuration Dialog</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_7.png" scale="80"/>
                </imageobject>
            </mediaobject>
        </figure>


        <para>Clicking on the <emphasis>
                <property>Search...</property>
            </emphasis> button brings us to a Choose Class dialog.</para>


        <figure>
            <title>The Choose Action Handler Dialog</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_8.png"/>
                </imageobject>
            </mediaobject>
        </figure>


        <para> We choose our previously created &apos;HelloActionHandler&apos; class and
            push the <property>OK</property> button. After the selection of the action handler for
            the action, we can run the test and observe it gives us a green light.</para>

        <figure>
            <title>Test Results</title>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/The_JBoss_jBPM_Int_Mech/jboss_jbpm_int_mech_9.png"
                        scale="70"/>
                </imageobject>
            </mediaobject>
        </figure>

        <para>There we are. The above objective has been achieved.</para>
    </section>

    <section>
        <title> Integration Points</title>

        <para> The different integration points in a process definition are thoroughly documented in
            the <ulink 
                url="http://docs.jboss.com/jbpm/v3/userguide/">JBoss jBPM User Guide</ulink>. Instance nodes can contain many action
            elements. Each of these will appear in the Action element list of the Actions tab. But
            each Action also has a properties view of itself. You can navigate to this view by
            selecting the added Action in the outline view. </para>

    </section>

</chapter>
